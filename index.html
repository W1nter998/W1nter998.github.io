<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="鋆赫财税，提供专业的公司注册、代理记账、税务筹划、工商年报、财务咨询等一站式企业财税服务。助力中小企业安心经营，合规发展。">
  <meta name="keywords" content="鋆赫财税, 财税服务, 公司注册, 代理记账, 税务筹划, 工商年报, 财务咨询, 杭州财税, 企业服务">
  <title>鋆赫财税 - 专业企业财税服务</title>
  <link rel="stylesheet" href="style.css" />
  <script type="module" src="supabase.js"></script>
  <script type="module" src="navigation.js"></script>
</head>
<body>
  <div id="page-loading-overlay" class="page-loading-overlay">
    <div class="spinner"></div>
  </div>

  <header class="header">
    <div class="logo">
      <a href="index.html">
        <img src="logo.png" alt="鋆赫财税 Logo" />
      </a>
      <span>鋆赫财税</span>
    </div>
    <div id="nav-container"></div>
  </header>

  <main class="main container">
    <section class="intro">
      <h1>欢迎来到鋆赫财税</h1>
      <p>我们提供专业的企业财税服务，助力您安心经营，合规发展。</p>
      <p style="margin-top: 15px;">
        <a href="services.html" class="nav-action-button">了解我们的服务</a>
      </p>
    </section>

    <section class="home-section">
      <h2>我们的优势</h2>
      <div class="advantages-grid">
        <div class="advantage-item">
          <h3>专业团队</h3>
          <p>资深财税专家，提供精准高效的服务。</p>
        </div>
        <div class="advantage-item">
          <h3>一站式服务</h3>
          <p>从注册到年报，全面解决您的财税难题。</p>
        </div>
        <div class="advantage-item">
          <h3>高效便捷</h3>
          <p>流程优化，节省您的宝贵时间。</p>
        </div>
        <div class="advantage-item">
          <h3>风险控制</h3>
          <p>合法合规，有效规避财税风险。</p>
        </div>
      </div>
    </section>

    <section class="home-section">
      <h2>最新动态</h2>
      <div id="latest-news" class="post-list">
        <p class="loading-spinner">加载最新新闻...</p>
      </div>
      <p style="text-align: center; margin-top: 20px;">
        <a href="news.html" class="nav-action-button">查看更多新闻</a>
      </p>
    </section>

    <section class="home-section">
      <h2>热门讨论</h2>
      <div id="hot-topics" class="post-list">
        <p class="loading-spinner">加载热门讨论...</p>
      </div>
      <p style="text-align: center; margin-top: 20px;">
        <a href="forum.html" class="nav-action-button">前往论坛</a>
      </p>
    </section>

  </main>

  <footer class="footer">
    <p>© 2025 杭州鋆赫财税咨询有限公司 版权所有</p>
  </footer>

  <script type="module">
    import { renderNavigationBar } from './navigation.js';
    import { supabase } from './supabase.js';

    document.addEventListener('DOMContentLoaded', async () => {
        // 渲染导航栏
        renderNavigationBar('nav-container', 'index.html');

        const loadingOverlay = document.getElementById('page-loading-overlay');
        loadingOverlay.classList.add('hidden'); // 页面加载后隐藏加载覆盖层

        // 加载最新新闻
        async function loadLatestNews() {
            const newsContainer = document.getElementById('latest-news');
            newsContainer.innerHTML = '<p class="loading-spinner">加载最新新闻...</p>';
            const { data: posts, error } = await supabase
                .from('posts')
                .select('id, title, content, created_at, category')
                .eq('category', 'news') // 假设新闻类别为 'news'
                .order('created_at', { ascending: false })
                .limit(3); // 只显示最新的3条

            if (error) {
                newsContainer.innerHTML = `<p class="form-message error">加载新闻失败：${error.message}</p>`;
                return;
            }

            if (!posts.length) {
                newsContainer.innerHTML = '<p>暂无最新新闻。</p>';
                return;
            }

            newsContainer.innerHTML = ''; // 清空加载提示
            posts.forEach(post => {
                const div = document.createElement('div');
                div.className = 'post-item';
                div.innerHTML = `
                    <a href="post-detail.html?id=${post.id}">
                        <h3>${post.title}</h3>
                        <p>${post.content}</p>
                        <small>发布于 ${new Date(post.created_at).toLocaleDateString()}</small>
                    </a>
                `;
                newsContainer.appendChild(div);
            });
        }

        // 加载热门讨论（这里我们简单取最新的3条论坛帖子）
        async function loadHotTopics() {
            const topicsContainer = document.getElementById('hot-topics');
            topicsContainer.innerHTML = '<p class="loading-spinner">加载热门讨论...</p>';
            const { data: posts, error } = await supabase
                .from('posts')
                .select('id, title, content, created_at, category')
                .eq('category', 'forum') // 假设论坛类别为 'forum'
                .order('created_at', { ascending: false })
                .limit(3); // 只显示最新的3条

            if (error) {
                topicsContainer.innerHTML = `<p class="form-message error">加载热门讨论失败：${error.message}</p>`;
                return;
            }

            if (!posts.length) {
                topicsContainer.innerHTML = '<p>暂无热门讨论，快来发帖吧！</p>';
                return;
            }

            topicsContainer.innerHTML = ''; // 清空加载提示
            posts.forEach(post => {
                const div = document.createElement('div');
                div.className = 'post-item';
                div.innerHTML = `
                    <a href="post-detail.html?id=${post.id}">
                        <h3>${post.title}</h3>
                        <p>${post.content}</p>
                        <small>发布于 ${new Date(post.created_at).toLocaleDateString()}</small>
                    </a>
                `;
                topicsContainer.appendChild(div);
            });
        }

        // 同时加载数据
        await Promise.all([
            loadLatestNews(),
            loadHotTopics()
        ]);
    });
  </script>
</body>
</html>